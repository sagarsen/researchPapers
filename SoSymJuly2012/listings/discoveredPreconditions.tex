
//Discovered Model Transformation pre-condition constraints

/* 1. At a depth of 4 the type of an attribute has to be primitive  and cannot be a class type*/

fact no4CyclicClassAttribute{
	all a:Attribute | a.type in Class => all a1:a.type.attrs|a1.type in
	Class => all a2:a.type.attrs|a2.type in Class => all
	a3:a.type.attrs|a3.type in Class => all a4:a.type.attrs|a4.type
	in PrimitiveDataType }

/* 2.  A Class cannot have an association and an attribute of the same name */

fact noAttribAndAssocSameName{
	all c:Class, assoc:Association | all a : c.attrs | (assoc.src == c) => a.name != assoc.name
}


/* 3. No cycles between non-persistent classes */

fact no1CycleNonPersistent
{
      all a: Association | (a.dest == a.src) => a.dest.is_persistent= True 
}



fact no2CycleNonPersistent
{
      all a1: Association, a2:Association | (a1.dest == a2.src and a2.dest==a1.src) => a1.src.is_persistent= True or a2.src.is_persistent=True  
}



/* 4.  A persistent class can't have an association to one of its parent */

fact assocPersistentClass
{
	all a:Association | a.src.is_persistent=True implies a.dest not in a.src.^parent
}



/* 5. Unique association names in a class hierarchy */

fact uniqueAssocNamesInInHeritanceTree
{
     all c:Class |
    all a1:Association, a2:Association |
    (a1.src in c and a2.src in c.^parent and a1!=a2) implies (a1.name!=a2.name)
    
   
 }


/* 6. A class can't be the type of one of its attributes (amoung all its
attributes */


fact classCantTypeOfAllofItsAttribute
{
 all c:Class | all a: (c.attrs+c.^parent.attrs) | a.type !=c
} 

/* 7. A Class A which inherits from a persistent class B can't have an outgoing association with the same name
that one association of that persistent class B */

fact classInheritsOutgoingNotSameNameAssoc
{
	all A:Class | all B:A.^parent | B.is_persistent == True implies (no a1: Association, a2:Association | 
(a1.src = A and a2.src=B and a1.name=a2.name))
}

/* 8. A class A which inherits from a persistent class B can't have an attribute with the same name 
that one attribute of that persistent class B */


fact classInheritsOutgoingNotSameNameAttrib
{
	all A:Class | all B:A.^parent | B.is_persistent == True implies (no a1: A.attrs, a2:B.attrs | 
(a1.name=a2.name))
}

/* 9. No association between two classes of an inheritance tree */

fact noAssocBetweenClassInHierarchy
{
	all a : Association | all c: Class | (a.src =c implies a.dest not in c.^parent) and (a.dest =c implies a.src not in c.^parent)
}